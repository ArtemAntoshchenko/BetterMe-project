{% extends 'base.html' %}
{% block title %}
    <title>Тепловая карта привычек</title>
{% endblock %}
{% block styles %}
<link rel="stylesheet" href="https://unpkg.com/cal-heatmap/dist/cal-heatmap.css">
<link rel="stylesheet" href="{{css_url}}/tracking.css">
{% endblock %}

{% block content %}
<div class="container">
    <h1>Тепловая карта привычек</h1>
    <div class="period-selector">
        <label for="period">Период:</label>
        <select id="period" onchange="changePeriod()">
            <option value="30">30 дней</option>
            <option value="90" selected>90 дней</option>
            <option value="180">6 месяцев</option>
            <option value="365">1 год</option>
        </select>
    </div>
    <div id="single-habit-heatmap"></div>
    <hr style="margin: 40px 0; border: none; border-top: 2px solid #eee;">
    <h2>Все привычки</h2>
    <div id="all-habits-heatmap"></div>
</div>
{% endblock %}
{% block sidebar_right %}
{% endblock %}
{% block scripts %}
<script src="https://unpkg.com/cal-heatmap/dist/cal-heatmap.min.js"></script>
<script src="{{js_url}}/tracking.js"></script>
<script>
    let singleHeatmap;
    let multiHeatmap;
    document.addEventListener('DOMContentLoaded', () => {
        const urlParts = window.location.pathname.split('/');
        const habitId = urlParts[urlParts.length - 1];
            
        singleHeatmap = new HabitHeatmap('single-habit-heatmap');
        multiHeatmap = new MultiHabitHeatmap('all-habits-heatmap');
            
            // Загружаем данные
        const days = parseInt(document.getElementById('period').value);
            
        if (habitId && !isNaN(habitId) && habitId !== 'heatmap') {
            singleHeatmap.loadHabitData(habitId, days);
        } else {
            document.getElementById('single-habit-heatmap').innerHTML = 
                '<p class="loading">Выберите привычку для просмотра детальной статистики</p>';
        }
            
        multiHeatmap.loadAllHabits(days);
    });
        
    function changePeriod() {
        const days = parseInt(document.getElementById('period').value);
            
            // Очищаем контейнеры
        document.getElementById('single-habit-heatmap').innerHTML = '';
        document.getElementById('all-habits-heatmap').innerHTML = '';
            
            // Перезагружаем с новым периодом
        const urlParts = window.location.pathname.split('/');
        const habitId = urlParts[urlParts.length - 1];
            
        if (habitId && !isNaN(habitId) && habitId !== 'heatmap') {
            singleHeatmap.loadHabitData(habitId, days);
        }
            
        multiHeatmap.loadAllHabits(days);
    }
</script>
{% endblock %}
